<?xml version="1.0"?>
<!-- 

  
-->
<system name="NoseWheelSteering">

  <!-- <property>fcs/steering/steer-pos-deg</property> -->

  <channel name="Steering">
          
  <!-- Calculation of castered section -->

    <pure_gain name="fcs/steering/speed-sensitive-centering">
      <input>velocities/vg-fps</input>
      <gain>0.1176</gain>
      <clipto>
        <min>0</min>
        <max>1</max>
      </clipto>
    </pure_gain>

    <fcs_function name="fcs/steering/slip-error-deg">
      <function>
        <product>
          <property>gear/unit[0]/side_friction_coeff</property> <!-- Computing real force generated by tyre -->
          <property>gear/unit[0]/compression-ft</property>
          <property>gear/unit[0]/static_friction_coeff</property>
          <value>91358</value> <!-- 54815 lb/ft (spring stiffness) * 1.666 (1/0.6 static friction) -->
          <property>fcs/steering/speed-sensitive-centering</property>
          <value>0.001</value>
        </product>
      </function>
    </fcs_function>

    <fcs_function name="fcs/steering/center-error-deg">
      <function>
        <product>
          <!--<table>
            <independentVar>fcs/steering/steer-pos-deg</independentVar>
            <tableData>
             -63            0
             -25            0
             -13            0.05
              0             0 
              13           -0.05
              25            0         
              63            0           
            </tableData>
          </table>-->
          <value>0.00</value>
        </product>
      </function>
    </fcs_function>

    <summer name="fcs/steering/steer-cmd-deg-castered">
      <input>fcs/steering/steer-pos-deg</input>
      <input>fcs/steering/slip-error-deg</input>
      <input>fcs/steering/center-error-deg</input>
      <clipto>
        <min>-63</min>
        <max>63</max>
      </clipto>
    </summer>

    <pure_gain name="fcs/steering/steer-cmd-norm-castered">
      <input>fcs/steering/steer-cmd-deg-castered</input>
      <gain>0.015873016</gain>
    </pure_gain>

    <kinematic>
      <input>fcs/steering/steer-cmd-norm-castered</input>
        <traverse>
          <setting>
            <position>-1</position>
            <time>0</time>
          </setting>
          <setting>
            <position>1</position>
            <time>3</time>
          </setting>
        </traverse>
      <output>fcs/steering/steer-cmd-norm-castered-kinematic</output>
    </kinematic>
 
  <!-- Calculation of steerable section -->
         
    <scheduled_gain name="fcs/steering/steer-cmd-norm">
      <input>-fcs/rudder-cmd-norm</input>
      <table>
        <independentVar> gear/steering </independentVar>
        <tableData>
          10            0.158
          63            1.0
        </tableData>
      </table>
    </scheduled_gain>     

    <switch name="fcs/steering/steer-cmd-norm-overall">
      <default value="fcs/steering/steer-cmd-norm-final"/>
      <test value="fcs/steering/steer-cmd-norm">
        gear/nose-wheel-steering == 1
        systems/electrical-ok == 1
        hs/hs2-busters-ok == 1
      </test>
    </switch>

    <kinematic name="fcs/steering/steer-cmd-norm-switched-kinematic">
      <input>fcs/steering/steer-cmd-norm-overall</input>
        <traverse>
          <setting>
            <position>-1</position>
            <time>0</time>
          </setting>
          <setting>
            <position>1</position>
            <time>3</time>
          </setting>
        </traverse>
    </kinematic>
	  
  <!-- Calculation of summed deflection -->

    <switch name="fcs/steering/steer-cmd-norm-final">
      <default value="fcs/steering/steer-cmd-norm-castered-kinematic"/>
      <test value="fcs/steering/steer-cmd-norm-switched-kinematic">
        gear/nose-wheel-steering == 1
        systems/electrical-ok == 1
        hs/hs2-busters-ok == 1
      </test>
    </switch>

    <pure_gain name="fcs/steering/steer-pos-deg">
      <input>fcs/steering/steer-cmd-norm-final</input>
      <gain>63</gain>
      <output>fcs/steer-pos-deg</output>
    </pure_gain>

  </channel>

</system>

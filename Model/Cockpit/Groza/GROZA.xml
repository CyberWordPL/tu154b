<?xml version="1.0"?>
<PropertyList>

  <path>GROZA.ac</path>

  <!--<effect>
    <inherits-from>Effects/Tu154b-GrozaGlass</inherits-from>
    <object-name>l4_Glass</object-name>
    <object-name>l2.1_Sector</object-name>
    <object-name>l2.2_Sector</object-name>
    <object-name>l2.3_Curtain</object-name>
    <object-name>l3.1_ScanLine</object-name>
  </effect>-->
  <effect>
    <inherits-from>Effects/Tu154b_Groza</inherits-from>
    <object-name>Groza_Panel</object-name>
    <object-name>b_off</object-name>
    <object-name>b_on</object-name>
    <object-name>b_left</object-name>
    <object-name>b_right</object-name>
    <object-name>Handle</object-name>
    <object-name>kn_angle</object-name>
    <object-name>kn_arcs</object-name>
    <object-name>kn_brt</object-name>
    <object-name>kn_contrast</object-name>
    <object-name>kn_freq</object-name>
    <object-name>kn_mode</object-name>
    <object-name>kn_range</object-name>
    <object-name>lamp_cover</object-name>
    <object-name>Mounting</object-name>
    <!--<object-name>l1_Groza</object-name>
    <object-name>l3_Screen</object-name>-->
  </effect>

  <animation>
    <type>noshadow</type>
    <object-name>l2.1_Sector</object-name>
    <object-name>l2.2_Sector</object-name>
    <object-name>l2.3_Curtain</object-name>
    <object-name>l3.1_ScanLine</object-name>
  </animation>

 <effect>
  <object-name>l5_Net</object-name>
  <inherits-from>Effects/azimuth</inherits-from>
  <parameters>
   <lightmap-factor type="float" n="0">
    <use>instrumentation/GROZA/screen/arcs_brt</use>
   </lightmap-factor>
  </parameters>
 </effect>

  <animation>
    <type>texrotate</type>
    <object-name>l2.1_Sector</object-name>
    <property>instrumentation/GROZA/screen/sec_dir</property>
    <offset-deg>-3</offset-deg>
    <center>
      <x>0.25</x>
      <y>0.25</y>
    </center>
    <axis>
      <x>0</x>
      <y>0</y>
      <z>1</z>
    </axis>
  </animation>
  <animation>
    <type>texrotate</type>
    <object-name>l2.2_Sector</object-name>
    <property>instrumentation/GROZA/screen/sec_dir</property>
    <offset-deg>3</offset-deg>
    <center>
      <x>0.25</x>
      <y>0.25</y>
    </center>
    <axis>
      <x>0</x>
      <y>0</y>
      <z>-1</z>
    </axis>
  </animation>
  <animation>
    <type>texrotate</type>
    <object-name>l2.3_Curtain</object-name>
    <property>instrumentation/GROZA/screen/sec_dir</property>
    <factor>-0.25</factor>
    <center>
      <x>0.75</x>
      <y>0.25</y>
    </center>
    <axis>
      <x>0</x>
      <y>0</y>
      <z>1</z>
    </axis>
  </animation>
  <animation>
    <type>select</type>
    <object-name>l2.1_Sector</object-name>
    <condition>
     <and>
       <equals>
         <property>instrumentation/GROZA/screen/fetch_dir</property>
         <value>1</value>
       </equals>
       <equals>
         <property>instrumentation/GROZA/screen/show_fade</property>
         <value>1</value>
       </equals>
     </and>
    </condition>
  </animation>
  <animation>
    <type>select</type>
    <object-name>l2.2_Sector</object-name>
    <condition>
     <and>
       <equals>
         <property>instrumentation/GROZA/screen/fetch_dir</property>
         <value>0</value>
       </equals>
       <equals>
         <property>instrumentation/GROZA/screen/show_fade</property>
         <value>1</value>
       </equals>
     </and>
    </condition>
  </animation>
  <animation>
    <type>select</type>
    <object-name>l2.3_Curtain</object-name>
    <condition>
     <equals>
       <property>instrumentation/GROZA/screen/show_fade</property>
       <value>1</value>
     </equals>
    </condition>
  </animation>

  <!-- Scan line -->
  <animation>
    <type>material</type>
    <object-name>l3.1_ScanLine</object-name>
    <ambient>
      <red>0.0</red>
      <green>0.0</green>
      <blue>0.0</blue>
    </ambient>
    <diffuse>
      <red>0.0</red>
      <green>0.0</green>
      <blue>0.0</blue>
    </diffuse>
    <specular>
      <red>0.0</red>
      <green>0.0</green>
      <blue>0.0</blue>
    </specular>
    <emission>
      <red>1.0</red>
      <green>1.0</green>
      <blue>1.0</blue>
      <factor-prop>instrumentation/GROZA/screen/scline_brt</factor-prop>
    </emission>
  </animation>
  <animation>
    <type>rotate</type>
    <expression>
      <min>
        <value>100</value>
        <max>
          <value>-100</value>
          <sum>
            <property>instrumentation/GROZA/screen/sec_dir</property>
            <product>
              <sum>
                <value>3</value>
                <product>
                  <value>-6</value>
                  <property>instrumentation/GROZA/screen/fetch_dir</property>
                </product>
              </sum>
              <min>
                <value>1</value>
                <difference>
                  <value>5</value>
                  <property>instrumentation/GROZA/global_mode</property>
                </difference>
              </min>
            </product>
          </sum>
        </max>
      </min>
    </expression>
    <object-name>l3.1_ScanLine</object-name>
    <center>
      <x-m> 0.5623</x-m>
      <y-m> -0.051</y-m>
      <z-m> 0.815</z-m>
    </center>
    <axis>
      <x>-1</x>
      <y>0</y>
      <z>0</z>
    </axis>
  </animation>

  <!-- Hide canvas (saves FPS) -->
  <animation>
    <type>select</type>
    <object-name>l1_Groza</object-name>
    <object-name>l3.1_ScanLine</object-name>
    <condition>
     <not>
       <or>
         <equals>
           <property>instrumentation/GROZA/status/stop_seq</property>
           <value>3</value>
         </equals>
         <equals>
           <property>instrumentation/GROZA/status/pause_seq</property>
           <value>2</value>
         </equals>
       </or>
     </not>
    </condition>
  </animation>
  <animation>
    <type>select</type>
    <object-name>l3_Screen</object-name>
    <condition>
     <or>
       <equals>
         <property>instrumentation/GROZA/status/stop_seq</property>
         <value>3</value>
       </equals>
       <equals>
         <property>instrumentation/GROZA/status/pause_seq</property>
         <value>2</value>
       </equals>
       <property>instrumentation/GROZA/screen/scline_cover</property>
     </or>
    </condition>
  </animation>

  <!-- Knobs and buttons -->
  <animation>
    <type>translate</type>
    <object-name>b_on</object-name>
    <property>instrumentation/GROZA/buttons/b_on</property>
    <factor>0.00375</factor>
    <axis>
      <x>-1.0</x>
      <y>0.0</y>
      <z>0.0</z>
    </axis>
  </animation>
  <animation>
    <type>pick</type>
    <object-name>b_on</object-name>
    <action>
      <button>0</button>
      <repeatable>false</repeatable>
      <binding>
        <command>property-assign</command>
        <property>instrumentation/GROZA/buttons/b_on</property>
        <value>1</value>
      </binding>
      <mod-up>
        <binding>
          <command>property-assign</command>
          <property>instrumentation/GROZA/buttons/b_on</property>
          <value>0</value>
        </binding>
      </mod-up>
    </action>
    <hovered>
      <binding>
        <command>set-tooltip</command>
        <label>Radar: enable (%s)</label>
        <tooltip-id>Groza_on</tooltip-id>
        <mapping>nasal</mapping>
        <property>instrumentation/GROZA/status/heat_est</property>
        <script>
          var result = ["OFF", "ON"][getprop("instrumentation/GROZA/status/power")];
          if ( getprop("instrumentation/GROZA/status/power") and arg[0] and !getprop("instrumentation/GROZA/status/serviceable") ) {
            result = result ~ ", heating up";
          }
          return result
        </script>
      </binding>
    </hovered>
  </animation>

  <animation>
    <type>translate</type>
    <object-name>b_off</object-name>
    <property>instrumentation/GROZA/buttons/b_off</property>
    <factor>0.00375</factor>
    <axis>
      <x>-1.0</x>
      <y>0.0</y>
      <z>0.0</z>
    </axis>
  </animation>
  <animation>
    <type>pick</type>
    <object-name>b_off</object-name>
    <action>
      <button>0</button>
      <repeatable>false</repeatable>
      <binding>
        <command>property-assign</command>
        <property>instrumentation/GROZA/buttons/b_off</property>
        <value>1</value>
      </binding>
      <mod-up>
        <binding>
          <command>property-assign</command>
          <property>instrumentation/GROZA/buttons/b_off</property>
          <value>0</value>
        </binding>
      </mod-up>
    </action>
    <hovered>
      <binding>
        <command>set-tooltip</command>
        <label>Radar: disable (%s)</label>
        <tooltip-id>Groza_off</tooltip-id>
        <mapping>nasal</mapping>
        <property>instrumentation/GROZA/status/heat_est</property>
        <script>
          var result = ["OFF", "ON"][getprop("instrumentation/GROZA/status/power")];
          if ( getprop("instrumentation/GROZA/status/power") and arg[0] and !getprop("instrumentation/GROZA/status/serviceable") ) {
            result = result ~ ", heating up";
          }
          return result
        </script>
      </binding>
    </hovered>
  </animation>

  <animation>
    <type>translate</type>
    <object-name>b_left</object-name>
    <property>instrumentation/GROZA/buttons/b_left</property>
    <factor>0.00375</factor>
    <axis>
      <x>-1.0</x>
      <y>0.0</y>
      <z>0.0</z>
    </axis>
  </animation>
  <animation>
    <type>pick</type>
    <object-name>b_left</object-name>
    <action>
      <button>0</button>
      <repeatable>false</repeatable>
      <binding>
        <command>property-assign</command>
        <property>instrumentation/GROZA/buttons/b_left</property>
        <value>1</value>
      </binding>
      <mod-up>
        <binding>
          <command>property-assign</command>
          <property>instrumentation/GROZA/buttons/b_left</property>
          <value>0</value>
        </binding>
      </mod-up>
    </action>
    <hovered>
      <binding>
        <command>set-tooltip</command>
        <label>Move the scan line to the left (Drift mode only!)</label>
        <tooltip-id>Groza_scan_left</tooltip-id>
      </binding>
    </hovered>
  </animation>

  <animation>
    <type>translate</type>
    <object-name>b_right</object-name>
    <property>instrumentation/GROZA/buttons/b_right</property>
    <factor>0.00375</factor>
    <axis>
      <x>-1.0</x>
      <y>0.0</y>
      <z>0.0</z>
    </axis>
  </animation>
  <animation>
    <type>pick</type>
    <object-name>b_right</object-name>
    <action>
      <button>0</button>
      <repeatable>false</repeatable>
      <binding>
        <command>property-assign</command>
        <property>instrumentation/GROZA/buttons/b_right</property>
        <value>1</value>
      </binding>
      <mod-up>
        <binding>
          <command>property-assign</command>
          <property>instrumentation/GROZA/buttons/b_right</property>
          <value>0</value>
        </binding>
      </mod-up>
    </action>
    <hovered>
      <binding>
        <command>set-tooltip</command>
        <label>Move the scan line to the right (Drift mode only!)</label>
        <tooltip-id>Groza_scan_right</tooltip-id>
      </binding>
    </hovered>
  </animation>

  <animation>
    <type>pick</type>
    <object-name>kn_freq</object-name>
    <action>
      <button>0</button>
      <repeatable>false</repeatable>
      <binding>
        <command>property-cycle</command>
        <property>instrumentation/GROZA/screen/show_fade</property>
        <value type="bool">1</value>
        <value type="bool">0</value>
      </binding>
      <binding>
        <command>property-adjust</command>
        <property>instrumentation/GROZA/status/heat_est</property>
        <step>-240</step>
        <min>1</min>
        <max>240</max>
      </binding>
    </action>
    <hovered>
      <binding>
        <command>set-tooltip</command>
        <label>%s</label>
        <tooltip-id>Groza_fade</tooltip-id>
        <mapping>nasal</mapping>
        <property>instrumentation/GROZA/screen/show_fade</property>
        <script>return sprintf("Frequency\n(not implemented,\n\"Storage tube\" mode: %s)", ["ON", "OFF"][arg[0]])</script>
      </binding>
    </hovered>
  </animation>

  <animation>
    <type>knob</type>
    <object-name>kn_angle</object-name>
    <property>instrumentation/GROZA/info/pitch_add</property>
    <factor>-9</factor>
    <offset-deg>0</offset-deg>
    <center>
      <x-m>0</x-m>
      <y-m>-0.051</y-m>
      <z-m>0.76</z-m>
    </center>
    <axis>
      <x>1</x>
      <y>0</y>
      <z>0</z>
    </axis>
    <action>
      <binding>
        <command>property-adjust</command>
        <property>instrumentation/GROZA/info/pitch_add</property>
        <factor>1</factor>
        <min>-15</min>
        <max>10</max>
        <wrap>false</wrap>
      </binding>
    </action>
    <hovered>
      <binding>
        <command>set-tooltip</command>
        <label>Weather / Turb. slope: %3i deg.</label>
        <tooltip-id>Groza_angle</tooltip-id>
        <mapping>nasal</mapping>
        <property>instrumentation/GROZA/info/pitch_add</property>
        <script>return arg[0]</script>
      </binding>
    </hovered>
  </animation>

  <animation>
    <type>knob</type>
    <object-name>kn_arcs</object-name>
    <property>instrumentation/GROZA/screen/arcs_bright</property>
    <factor>-255</factor>
    <offset-deg>127.5</offset-deg>
    <center>
      <x-m>0</x-m>
      <y-m>0.024</y-m>
      <z-m>0.7805</z-m>
    </center>
    <axis>
      <x>1</x>
      <y>0</y>
      <z>0</z>
    </axis>
    <action>
      <binding>
        <command>property-adjust</command>
        <property>instrumentation/GROZA/screen/arcs_bright</property>
        <factor>0.01</factor>
        <min>0</min>
        <max>1.0</max>
        <wrap>false</wrap>
      </binding>
    </action>
    <hovered>
      <binding>
        <command>set-tooltip</command>
        <label>Grid: %3d%%</label>
        <tooltip-id>Groza_arcs</tooltip-id>
        <mapping>percent</mapping>
        <property>instrumentation/GROZA/screen/arcs_bright</property>
      </binding>
    </hovered>
  </animation>

  <animation>
    <type>knob</type>
    <object-name>kn_mode</object-name>
    <property>instrumentation/GROZA/global_mode</property>
    <drag-scale-px>150</drag-scale-px>
    <factor>-30</factor>
    <offset-deg>90</offset-deg>
    <center>
      <x-m>0</x-m>
      <y-m>-0.117</y-m>
      <z-m>0.735</z-m>
    </center>
    <axis>
      <x>1</x>
      <y>0</y>
      <z>0</z>
    </axis>
    <action>
      <binding>
        <command>property-adjust</command>
        <property>instrumentation/GROZA/global_mode</property>
        <factor>1</factor>
        <min>1</min>
        <max>5</max>
        <wrap>false</wrap>
      </binding>
    </action>
    <hovered>
      <binding>
        <command>set-tooltip</command>
        <label>Radar mode: %s</label>
        <tooltip-id>Groza_mode</tooltip-id>
        <mapping>nasal</mapping>
        <property>instrumentation/GROZA/global_mode</property>
        <script>return ["Standby", "Terrain", "Weather", "Turbulence", "Drift"][arg[0] - 1]</script>
      </binding>
    </hovered>
  </animation>

  <animation>
    <type>knob</type>
    <object-name>kn_brt</object-name>
    <property>instrumentation/GROZA/screen/brightness</property>
    <factor>-255</factor>
    <offset-deg>127.5</offset-deg>
    <center>
      <x-m>0</x-m>
      <y-m>-0.0735</y-m>
      <z-m>0.7215</z-m>
    </center>
    <axis>
      <x>1</x>
      <y>0</y>
      <z>0</z>
    </axis>
    <action>
      <binding>
        <command>property-adjust</command>
        <property>instrumentation/GROZA/screen/brightness</property>
        <factor>0.01</factor>
        <min>0</min>
        <max>1.0</max>
        <wrap>false</wrap>
      </binding>
    </action>
    <hovered>
      <binding>
        <command>set-tooltip</command>
        <label>Brightness: %4d%% (0%% - 200%%)</label>
        <tooltip-id>Groza_brt</tooltip-id>
        <mapping>nasal</mapping>
        <property>instrumentation/GROZA/screen/brightness</property>
        <script>return 200*(arg[0])</script>
      </binding>
    </hovered>
  </animation>

  <animation>
    <type>knob</type>
    <object-name>kn_contrast</object-name>
    <property>instrumentation/GROZA/info/contrast</property>
    <factor>-127.5</factor>
    <offset-deg>127.5</offset-deg>
    <center>
      <x-m>0</x-m>
      <y-m>-0.0285</y-m>
      <z-m>0.7215</z-m>
    </center>
    <axis>
      <x>1</x>
      <y>0</y>
      <z>0</z>
    </axis>
    <action>
      <binding>
        <command>property-adjust</command>
        <property>instrumentation/GROZA/info/contrast</property>
        <factor>0.1</factor>
        <min>0</min>
        <max>2.0</max>
        <wrap>false</wrap>
      </binding>
    </action>
    <hovered>
      <binding>
        <command>set-tooltip</command>
        <label>Contrast: %2.1fx (0.0x - 2.0x)</label>
        <tooltip-id>Groza_contrast</tooltip-id>
        <property>instrumentation/GROZA/info/contrast</property>
      </binding>
    </hovered>
  </animation>

  <animation>
    <type>knob</type>
    <object-name>kn_range</object-name>
    <property>instrumentation/GROZA/range/range_pos</property>
    <drag-scale-px>150</drag-scale-px>
    <factor>-30</factor>
    <offset-deg>60</offset-deg>
    <center>
      <x-m>0</x-m>
      <y-m>0.015</y-m>
      <z-m>0.735</z-m>
    </center>
    <axis>
      <x>1</x>
      <y>0</y>
      <z>0</z>
    </axis>
    <action>
      <binding>
        <command>property-adjust</command>
        <property>instrumentation/GROZA/range/range_pos</property>
        <factor>1</factor>
        <min>0</min>
        <max>4</max>
        <wrap>false</wrap>
      </binding>
    </action>
    <hovered>
      <binding>
        <command>set-tooltip</command>
        <label>Range: %3u km</label>
        <tooltip-id>Groza_range</tooltip-id>
        <mapping>nasal</mapping>
        <property>instrumentation/GROZA/range/range</property>
        <script>return arg[0]</script>
      </binding>
    </hovered>
  </animation>

  <!-- On-the-go language switch -->
  <animation>
    <type>material</type>
    <object-name>Groza_Panel</object-name>
    <object-name>b_on</object-name>
    <object-name>b_off</object-name>
    <texture-prop>tu154/textures/lang/GROZA</texture-prop>
  </animation>

  <!-- Old panel lighting -->
  <animation>
    <type>material</type>
    <object-name>Groza_Panel</object-name>
    <object-name>b_off</object-name>
    <object-name>b_on</object-name>
    <object-name>b_left</object-name>
    <object-name>b_right</object-name>
    <object-name>Handle</object-name>
    <object-name>kn_angle</object-name>
    <object-name>kn_arcs</object-name>
    <object-name>kn_brt</object-name>
    <object-name>kn_contrast</object-name>
    <object-name>kn_freq</object-name>
    <object-name>kn_mode</object-name>
    <object-name>kn_range</object-name>
    <object-name>lamp_cover</object-name>
    <object-name>Mounting</object-name>
    <object-name>l4_Glass</object-name>
    <object-name>l5_Net</object-name>
    <condition>
      <not>
        <property>/tu154/light/cockpit-not-backup</property>
      </not>
    </condition>
    <emission>
      <red>0.067</red>
      <green>0.067</green>
      <blue>0.067</blue>
      <factor-prop>sim/multiplay/generic/float[0]</factor-prop>
    </emission>
  </animation>

</PropertyList>
